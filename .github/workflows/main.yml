name: Test MySQL Connection

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Start MySQL
        uses: docker://docker:19.03.13
        with:
          args: up -d mysql
      - name: Set Environment Variables
        run: |
          echo "::set-env name=DB_MYSQL_USERNAME::root"
          echo "::set-env name=DB_MYSQL_PASSWORD::root"
          echo "::set-env name=DB_MYSQL_PORT::3306"
          echo "::set-env name=DB_MYSQL_HOST::localhost"
          echo "::set-env name=DB_MYSQL_DATABASE::todo"
      - name: Wait for MySQL to be ready
        run: |
          while ! mysqladmin ping -h"$MYSQL_HOST" --silent; do
            sleep 1
          done
      - name: Run Tests
        run: go test
